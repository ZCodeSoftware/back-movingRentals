// üöÄ SCRIPT PARA AGREGAR √çNDICES CR√çTICOS
// Ejecutar este script en MongoDB Compass o mongo shell
// Esto mejorar√° DR√ÅSTICAMENTE el rendimiento de las m√©tricas

// Conectar a tu base de datos
use('moving-rentals'); // Cambiar por el nombre de tu BD

// ============================================
// √çNDICES PARA BOOKINGS
// ============================================

// √çndice para b√∫squedas por status y fecha de pago
db.booking.createIndex(
  { 
    "status": 1, 
    "payments.paymentDate": 1 
  },
  { 
    name: "idx_status_payment_date",
    background: true 
  }
);

// √çndice para b√∫squedas por status y createdAt
db.booking.createIndex(
  { 
    "status": 1, 
    "createdAt": 1 
  },
  { 
    name: "idx_status_created",
    background: true 
  }
);

// √çndice para payments.status
db.booking.createIndex(
  { 
    "payments.status": 1 
  },
  { 
    name: "idx_payments_status",
    background: true 
  }
);

// √çndice compuesto para queries de m√©tricas
db.booking.createIndex(
  { 
    "status": 1,
    "payments.status": 1,
    "payments.paymentDate": 1
  },
  { 
    name: "idx_metrics_composite",
    background: true 
  }
);

// ============================================
// √çNDICES PARA MOVEMENTS
// ============================================

// √çndice para movements por direcci√≥n y fecha
db.movement.createIndex(
  { 
    "direction": 1, 
    "date": 1 
  },
  { 
    name: "idx_direction_date",
    background: true 
  }
);

// √çndice para movements por veh√≠culo
db.movement.createIndex(
  { 
    "vehicle": 1, 
    "direction": 1, 
    "date": 1 
  },
  { 
    name: "idx_vehicle_direction_date",
    background: true 
  }
);

// √çndice para isDeleted
db.movement.createIndex(
  { 
    "isDeleted": 1 
  },
  { 
    name: "idx_is_deleted",
    background: true 
  }
);

// ============================================
// √çNDICES PARA VEHICLES
// ============================================

// √çndice para veh√≠culos activos por categor√≠a
db.vehicle.createIndex(
  { 
    "isActive": 1,
    "category": 1
  },
  { 
    name: "idx_active_category",
    background: true 
  }
);

// ============================================
// √çNDICES PARA USERS
// ============================================

// √çndice para bookings de usuarios
db.user.createIndex(
  { 
    "bookings": 1 
  },
  { 
    name: "idx_user_bookings",
    background: true 
  }
);

// ============================================
// VERIFICAR √çNDICES CREADOS
// ============================================

print("\n=== √çNDICES EN BOOKING ===");
db.booking.getIndexes().forEach(idx => print(JSON.stringify(idx, null, 2)));

print("\n=== √çNDICES EN MOVEMENT ===");
db.movement.getIndexes().forEach(idx => print(JSON.stringify(idx, null, 2)));

print("\n=== √çNDICES EN VEHICLE ===");
db.vehicle.getIndexes().forEach(idx => print(JSON.stringify(idx, null, 2)));

print("\n=== √çNDICES EN USER ===");
db.user.getIndexes().forEach(idx => print(JSON.stringify(idx, null, 2)));

print("\n‚úÖ √çNDICES CREADOS EXITOSAMENTE");
print("‚ö° El rendimiento de las m√©tricas deber√≠a mejorar significativamente");
